<!DOCTYPE html>
<html>

<head>
  <title>Species Choices Experiment</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-audio-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>

<body></body>
<script>

  // initialize jsPsych
  var jsPsych = initJsPsych({
    on_finish: function () {
      jsPsych.data.displayData();
    }
  });

  // create timeline
  var timeline = [];

  // preload images
  var preload = {
    type: jsPsychPreload,
    images: [
      'stimuli/bike.png',
      'stimuli/boat.png',
      'stimuli/bunny.png',
      'stimuli/cant decide.png',
      'stimuli/cat.png',
      'stimuli/clam.png',
      'stimuli/dog.png',
      'stimuli/person.png',
      'stimuli/pig.png',
    ]
  };
    timeline.push(preload);

  // define welcome message trial
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment. Press any key to begin."
  };
  timeline.push(welcome);

  // instructions for trials
  var instruction = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus:  `<p>We are going to ask you some moral questions in which you have to make
                choices. These questions can be hard to decide. There is no right or wrong
                answer - you just choose whatever you personally think is right. Please
                choose whatever you would actually choose in real life.</p>
                <p>Press any key to begin.</p>`
  };
  timeline.push(instruction)

  var control_stimuli = [
    {
      choices: ['<img src="stimuli/plate.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/dog.png">'],
      prompt: ['A plate', '1 dog']
    },
    {
      choices: ['<img src="stimuli/person.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/bike.png">'],
      prompt: ['1 person', 'A bike']
    },
    {
      choices: ['<img src="stimuli/plate.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/person.png">'],
      prompt: ['A plate', '1 person']
    }
  ];
  
  var test_stimuli = [
  {
    choices: ['<img src="stimuli/person.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/dog.png">'],
    prompt: ['1 person', '1 dog']
  },
  {
    choices: ['<img src="stimuli/person.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/dog.png">'],
    prompt: ['1 person', '2 dogs']
  },
  {
    choices: ['<img src="stimuli/dog.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/person.png">'],
    prompt: ['10 dog', '1 person']
  },
  {
    choices: ['<img src="stimuli/dog.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/person.png">'],
    prompt: ['1 dog', '2 persons']
  },
  {
    choices: ['<img src="stimuli/dog.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/person.png">'],
    prompt: ['1 dog', '10 persons']
  },
  {
    choices: ['<img src="stimuli/person.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/dog.png">'],
    prompt: ['1 person', '100 dog']
  },
  {
    choices: ['<img src="stimuli/person.png">', '<img src="stimuli/cant decide.png">','<img src="stimuli/dog.png">'],
    prompt: ['100 persons', '1 dog']
  }
  ];
  
  // Pre-test trial to introduce the boat scenario
  var pre_test = {
    type: jsPsychImageKeyboardResponse,
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p>Imagine a situation involving two boats. Both of these boats are sinking. 
                Unfortunately, no one on either of the boats is able to swim. But you can
                choose one boat to save. Once you choose a boat, everyone on that boat will
                be safe.</p>`,
    choices: ['<img src="stimuli/boat.png">', '<img src="stimuli/cant decide.png">', '<img src="stimuli/boat.png">'],
    prompt: `<p>You can either save Boat A or Boat B. If it's too difficult to choose between
                them, you can select 'Can't decide'.</p>`
  }
    timeline.push(pre_test);

  // go through the control stimuli
  for (let i = 0; i < control_stimuli.length; i++) {
    current_trial = control_stimuli[i];
    
    var control = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `On one boat there is ${control_stimuli[i].prompt[0]} and the other boat there is ${control_stimuli[i].prompt[1]}. Will you save...`,
        choices: control_stimuli[0].choices,
        prompt: `<p>You can either choose Option A or Option B. If it's too difficult to choose between
                    them, you can select 'Can't decide'.</p>`
    }
  }


  // iterate through test stimuli and create a trial for each one
  for (let i = 0; i < test_stimuli.length; i++) {
    console.log("current trial: ", i);
    current_trial = test_stimuli[i];

    var test = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `On one boat there is <b>${test_stimuli[i].prompt[0]}</b> and the other boat there is <b>${test_stimuli[i].prompt[1]}</b>. Will you save...`,
        choices: test_stimuli[0].choices,
        prompt: `<p>You can either choose Option A or Option B. If it's too difficult to choose between
                    them, you can select 'Can't decide'.</p>`
    }

    timeline.push(test);
  }

  var test_procedure = {
      timeline: [test],
      timeline_variables: test_stimuli,
      randomize_order: true, //randomize order of stimuli
    };

    //timeline.push(test_procedure);

  // start the experiment
  jsPsych.run(timeline);

</script>

</html>
